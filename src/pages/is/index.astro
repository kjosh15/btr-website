---
import { getEntryBySlug } from 'astro:content';

import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Section from '../../components/Section.astro';
import CtaGroup from '../../components/CtaGroup.astro';
import LogoCarousel from '../../components/LogoCarousel.astro';
import ContactForm from '../../components/ContactForm.astro';
import StatsGrid from '../../components/StatsGrid.astro';
import StepsTimeline from '../../components/StepsTimeline.astro';
import CaseGrid from '../../components/CaseGrid.astro';
import BenefitCards from '../../components/BenefitCards.astro';
import locale from '../../locales/is.json';

const hero = await getEntryBySlug('is', 'hero');
const why = await getEntryBySlug('is', 'why');
const process = await getEntryBySlug('is', 'process');
const proof = await getEntryBySlug('is', 'proof');
const gov = await getEntryBySlug('is', 'gov');
const partners = await getEntryBySlug('is', 'partners');
const about = await getEntryBySlug('is', 'about');
const experience = await getEntryBySlug('is', 'experience');
const finalCta = await getEntryBySlug('is', 'final-cta');

const { Content: WhyContent } = await why.render();
const { Content: ProcessContent } = await process.render();
const { Content: ProofContent } = await proof.render();
const { Content: GovContent } = await gov.render();
const { Content: PartnersContent } = await partners.render();
const { Content: AboutContent } = await about.render();
const { Content: ExperienceContent } = await experience.render();
const { Content: FinalCtaContent } = await finalCta.render();

const navItems = locale.nav;
const alternate = { lang: 'en', href: '../' };
---
<BaseLayout lang="is" locale={locale} navItems={navItems} alternate={alternate} meta={locale.meta}>
  <Hero data={hero.data} />

  <Section
    id={why.data.section}
    eyebrow={why.data.eyebrow}
    heading={why.data.heading}
    background="muted"
  >
    {why.data.stats && <StatsGrid stats={why.data.stats} />}
    <div class="grid gap-8 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)] lg:items-start">
      <div class="space-y-6">
        <WhyContent />
      </div>
      {(why.data.calloutTitle || why.data.calloutBody) && (
        <aside class="rounded-3xl border border-btr-accent/15 bg-white/80 p-6 shadow-sm backdrop-blur">
          {why.data.calloutTitle && (
            <p class="text-xs font-semibold uppercase tracking-[0.32em] text-btr-accent">
              {why.data.calloutTitle}
            </p>
          )}
          {why.data.calloutBody && (
            <p class="mt-3 text-base font-medium text-btr-text/85">
              {why.data.calloutBody}
            </p>
          )}
        </aside>
      )}
    </div>
  </Section>

  <Section
    id={process.data.section}
    eyebrow={process.data.eyebrow}
    heading={process.data.heading}
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1fr)_minmax(0,1.1fr)] lg:items-start">
      <div class="space-y-6">
        <ProcessContent />
        {process.data.quote && (
          <blockquote class="rounded-3xl border border-btr-accent/20 bg-btr-muted/60 p-6 text-lg font-medium text-btr-text/85">
            “{process.data.quote}”
          </blockquote>
        )}
      </div>
      {process.data.steps && <StepsTimeline steps={process.data.steps} />}
    </div>
  </Section>

  <Section
    id={proof.data.section}
    eyebrow={proof.data.eyebrow}
    heading={proof.data.heading}
    background="muted"
  >
    <div class="grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(0,1fr)] lg:items-start">
      <div class="space-y-6">
        <ProofContent />
        {proof.data.cta && <CtaGroup ctas={[proof.data.cta]} />}
      </div>
      {proof.data.cases && <CaseGrid cases={proof.data.cases} />}
    </div>
  </Section>

  <Section
    id={gov.data.section}
    eyebrow={gov.data.eyebrow}
    heading={gov.data.heading}
  >
    <div class="grid gap-8 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] lg:items-start">
      <div class="space-y-6">
        <GovContent />
        {gov.data.cta && <CtaGroup ctas={[gov.data.cta]} />}
      </div>
      {gov.data.benefits && (
        <div class="surface-card">
          <p class="text-xs font-semibold uppercase tracking-[0.32em] text-btr-text/55">
            [TODO] Ávinningur
          </p>
          <div class="mt-5">
            <BenefitCards items={gov.data.benefits} variant="gov" />
          </div>
        </div>
      )}
    </div>
  </Section>

  <Section
    id={partners.data.section}
    eyebrow={partners.data.eyebrow}
    heading={partners.data.heading}
    background="muted"
  >
    <div class="grid gap-8 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] lg:items-start">
      <div class="space-y-6">
        <PartnersContent />
        {partners.data.cta && <CtaGroup ctas={[partners.data.cta]} />}
      </div>
      {partners.data.benefits && (
        <div class="surface-card">
          <p class="text-xs font-semibold uppercase tracking-[0.32em] text-btr-text/55">
            [TODO] Ávinningur samstarfsaðila
          </p>
          <div class="mt-5">
            <BenefitCards items={partners.data.benefits} variant="partner" />
          </div>
        </div>
      )}
    </div>
  </Section>

  <Section
    id={about.data.section}
    eyebrow={about.data.eyebrow}
    heading={about.data.heading}
  >
    <AboutContent />
  </Section>

  <Section
    id={experience.data.section}
    eyebrow={experience.data.eyebrow}
    heading={experience.data.heading}
    support={experience.data.caption}
    background="accent"
  >
    <ExperienceContent />
    <LogoCarousel logos={experience.data.logos ?? []} />
  </Section>

  <Section
    id={finalCta.data.section}
    eyebrow={finalCta.data.eyebrow}
    heading={finalCta.data.heading}
    background="muted"
  >
    <FinalCtaContent />
    {finalCta.data.ctas && <CtaGroup ctas={finalCta.data.ctas} />}
  </Section>

  <ContactForm id="government-briefing" form={locale.forms.government} />
  <ContactForm id="partner-intake" form={locale.forms.partner} />
</BaseLayout>
