---
import { getEntryBySlug } from 'astro:content';

import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Section from '../../components/Section.astro';
import CtaGroup from '../../components/CtaGroup.astro';
import LogoCarousel from '../../components/LogoCarousel.astro';
import ContactForm from '../../components/ContactForm.astro';
import StatsGrid from '../../components/StatsGrid.astro';
import StepsTimeline from '../../components/StepsTimeline.astro';
import CaseGrid from '../../components/CaseGrid.astro';
import EngageCards from '../../components/EngageCards.astro';
import PartnerCarousel from '../../components/PartnerCarousel.astro';
import locale from '../../locales/is.json';

const hero = await getEntryBySlug('is', 'hero');
const why = await getEntryBySlug('is', 'why');
const process = await getEntryBySlug('is', 'process');
const proof = await getEntryBySlug('is', 'proof');
const about = await getEntryBySlug('is', 'about');
const engage = await getEntryBySlug('is', 'final-cta');

const { Content: WhyContent } = await why.render();
const { Content: ProcessContent } = await process.render();
const { Content: ProofContent } = await proof.render();
const { Content: AboutContent } = await about.render();
const { Content: EngageContent } = await engage.render();

const navItems = locale.nav;
const alternate = { lang: 'en', href: '../' };
const partnerLogos = [
  { name: 'OpenAI', file: 'openai.svg' },
  { name: 'Anthropic', file: 'anthropic.svg' },
  { name: 'Google Cloud', file: 'google-cloud.svg' },
  { name: 'AWS', file: 'aws.svg' },
  { name: 'NVIDIA', file: 'nvidia.svg' },
  { name: 'Microsoft', file: 'microsoft.svg' },
];

const rawMandate = about.data.mandate ?? '';
const [mandateHeadingRaw, ...mandateRest] = rawMandate.split(':');
const hasMandateSplit = mandateRest.length > 0;
const mandateHeadingBase = hasMandateSplit
  ? (mandateHeadingRaw?.trim() || 'Our mandate')
  : 'Our mandate';
const mandateHeading = mandateHeadingBase.replace(/[:;]*$/, '') + ';';
const mandateBody = hasMandateSplit ? mandateRest.join(':').trim() : rawMandate;
---
<BaseLayout lang="is" locale={locale} navItems={navItems} alternate={alternate} meta={locale.meta}>
<Hero data={hero.data} strings={locale.hero} />

  <Section
    id="partners"
    eyebrow="Stefnumótandi samstarf"
    heading="Samstarf við fremstu AI vistkerfin"
  >
    <p class="text-btr-text/75">
      Við viðhöldum virku samstarfi, trúnaðarsamningum og reglulegum verkefnafundum með leiðandi módel- og skýjaaðilum á borð við OpenAI, Anthropic, Google Cloud, AWS og NVIDIA svo stefna, tilraunir og innleiðing haldist í takt.
    </p>
    <div class="mt-8"><PartnerCarousel logos={partnerLogos} /></div>
  </Section>

  <Section
    id={why.data.section}
    eyebrow={why.data.eyebrow}
    heading={why.data.heading}
    background="muted"
  >
    {why.data.stats && (
      <StatsGrid
        stats={why.data.stats}
        sourceLabel={locale.stats.sourceLabel}
        sourceAriaPrefix={locale.stats.sourceAriaPrefix}
      />
    )}
    <div class="mt-8 space-y-6">
      <WhyContent />
      {(why.data.calloutTitle || why.data.calloutBody) && (
        <blockquote class="quote-card">
          {why.data.calloutTitle && (
            <span class="block text-sm font-semibold uppercase tracking-[0.28em] text-btr-accent">
              {why.data.calloutTitle}
            </span>
          )}
          <span class="mt-3 block text-btr-text/75">{why.data.calloutBody}</span>
        </blockquote>
      )}
    </div>
  </Section>

  <Section
    id={process.data.section}
    eyebrow={process.data.eyebrow}
    heading={process.data.heading}
    flushTop
  >
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)] lg:items-start">
      <div class="space-y-6">
        <ProcessContent />
        {process.data.quote && (
          <blockquote class="quote-card">
            “{process.data.quote}”
          </blockquote>
        )}
      </div>
      {process.data.steps && <StepsTimeline steps={process.data.steps} />}
    </div>
  </Section>

  <Section
    id={about.data.section}
    eyebrow={about.data.eyebrow}
    heading={about.data.heading}
    background="muted"
  >
    <AboutContent />
    {about.data.logos && (
      <div class="mt-10 rounded-3xl border border-btr-muted bg-btr-muted/50 p-6">
        <LogoCarousel logos={about.data.logos} />
      </div>
    )}
    {about.data.mandate && (
      <blockquote class="quote-card mt-8 text-left sm:text-center">
        <span class="block text-sm font-semibold uppercase tracking-[0.28em] text-btr-accent">
          {mandateHeading}
        </span>
        <span class="mt-3 block text-btr-text/75">
          {mandateBody}
        </span>
      </blockquote>
    )}
  </Section>

  <Section
    id={proof.data.section}
    eyebrow={proof.data.eyebrow}
    heading={proof.data.heading}
    flushTop
  >
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,1fr)] lg:items-start">
      <div class="space-y-6 text-btr-text/80">
        <ProofContent />
        {proof.data.cta && (
          <CtaGroup ctas={[proof.data.cta]} />
        )}
      </div>
      {proof.data.cases && <CaseGrid cases={proof.data.cases} />}
    </div>
  </Section>

  <Section
    id={engage.data.section}
    eyebrow={engage.data.eyebrow}
    heading={engage.data.heading}
    background="muted"
  >
    <EngageContent />
    <div class="mt-8">
      <ContactForm
        id="connect"
        form={locale.forms.combined}
        lang={locale.lang ?? 'is'}
        prefill={locale.forms.combined.prefill}
      />
    </div>
    {engage.data.actions && (
      <div class="mt-12">
        <EngageCards actions={engage.data.actions} />
      </div>
    )}
  </Section>
</BaseLayout>
