---
import { getEntryBySlug } from 'astro:content';

import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import CtaGroup from '../components/CtaGroup.astro';
import LogoCarousel from '../components/LogoCarousel.astro';
import ContactForm from '../components/ContactForm.astro';
import StatsGrid from '../components/StatsGrid.astro';
import StepsTimeline from '../components/StepsTimeline.astro';
import CaseGrid from '../components/CaseGrid.astro';
import EngageCards from '../components/EngageCards.astro';
import PartnerCarousel from '../components/PartnerCarousel.astro';
import locale from '../locales/en.json';

const hero = await getEntryBySlug('en', 'hero');
const why = await getEntryBySlug('en', 'why');
const process = await getEntryBySlug('en', 'process');
const proof = await getEntryBySlug('en', 'proof');
const about = await getEntryBySlug('en', 'about');
const engage = await getEntryBySlug('en', 'final-cta');

const { Content: WhyContent } = await why.render();
const { Content: ProcessContent } = await process.render();
const { Content: ProofContent } = await proof.render();
const { Content: AboutContent } = await about.render();
const { Content: EngageContent } = await engage.render();

const navItems = locale.nav;
const alternate = { lang: 'is', href: './is/' };
const partnerLogos = [
  { name: 'OpenAI', file: 'openai.svg' },
  { name: 'Anthropic', file: 'anthropic.svg' },
  { name: 'Google Cloud', file: 'google-cloud.svg' },
  { name: 'AWS', file: 'aws.svg' },
  { name: 'NVIDIA', file: 'nvidia.svg' },
  { name: 'Microsoft', file: 'microsoft.svg' },
];

const rawMandate = about.data.mandate ?? '';
const [mandateHeadingRaw, ...mandateRest] = rawMandate.split(':');
const hasMandateSplit = mandateRest.length > 0;
const mandateHeadingBase = hasMandateSplit
  ? (mandateHeadingRaw?.trim() || 'Our mandate')
  : 'Our mandate';
const mandateHeading = mandateHeadingBase.replace(/[:;]*$/, '') + ';';
const mandateBody = hasMandateSplit ? mandateRest.join(':').trim() : rawMandate;
---
<BaseLayout lang="en" locale={locale} navItems={navItems} alternate={alternate} meta={locale.meta}>
<Hero data={hero.data} strings={locale.hero} />

  <Section
    id="partners"
    eyebrow="Strategic Partners"
    heading="Working with the leading AI ecosystem"
  >
    <p class="text-btr-text/75">
      We maintain active NDAs, MOUs, and standing working sessions with OpenAI, Anthropic, Google Cloud, AWS, NVIDIA, and other frontier vendors so policy, pilots, and delivery teams stay aligned.
    </p>
    <div class="mt-8"><PartnerCarousel logos={partnerLogos} /></div>
    {about.data.mandate && (
      <blockquote class="quote-card mt-8 text-left sm:text-center">
        <span class="block text-sm font-semibold uppercase tracking-[0.28em] text-btr-accent">
          {mandateHeading}
        </span>
        <span class="mt-3 block text-btr-text/75">
          {mandateBody}
        </span>
      </blockquote>
    )}
  </Section>

  <Section
    id={why.data.section}
    eyebrow={why.data.eyebrow}
    heading={why.data.heading}
    background="muted"
  >
    {why.data.stats && (
      <StatsGrid
        stats={why.data.stats}
        sourceLabel={locale.stats.sourceLabel}
        sourceAriaPrefix={locale.stats.sourceAriaPrefix}
      />
    )}
    <div class="mt-8 space-y-6">
      <WhyContent />
      {(why.data.calloutTitle || why.data.calloutBody) && (
        <blockquote class="quote-card">
          {why.data.calloutTitle && (
            <span class="block text-sm font-semibold uppercase tracking-[0.28em] text-btr-accent">
              {why.data.calloutTitle}
            </span>
          )}
          <span class="mt-3 block text-btr-text/75">{why.data.calloutBody}</span>
        </blockquote>
      )}
    </div>
  </Section>

  <Section
    id={process.data.section}
    eyebrow={process.data.eyebrow}
    heading={process.data.heading}
    flushTop
  >
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.1fr)_minmax(0,0.9fr)] lg:items-start">
      <div class="space-y-6">
        <ProcessContent />
        {process.data.quote && (
          <blockquote class="quote-card">
            “{process.data.quote}”
          </blockquote>
        )}
      </div>
      {process.data.steps && <StepsTimeline steps={process.data.steps} />}
    </div>
  </Section>

  <Section
    id={about.data.section}
    eyebrow={about.data.eyebrow}
    heading={about.data.heading}
    background="muted"
  >
    <AboutContent />
    {about.data.logos && (
      <div class="mt-10 rounded-3xl border border-btr-muted bg-btr-muted/50 p-6">
        <LogoCarousel logos={about.data.logos} />
      </div>
    )}
  </Section>

  <Section
    id={proof.data.section}
    eyebrow={proof.data.eyebrow}
    heading={proof.data.heading}
    flushTop
  >
    <div class="grid gap-10 lg:grid-cols-[minmax(0,1.05fr)_minmax(0,0.95fr)] lg:items-start">
      <div class="space-y-6 text-btr-text/80">
        <ProofContent />
        {proof.data.cta && (
          <CtaGroup ctas={[proof.data.cta]} />
        )}
      </div>
      {proof.data.cases && <CaseGrid cases={proof.data.cases} />}
    </div>
  </Section>

  <Section
    id={engage.data.section}
    eyebrow={engage.data.eyebrow}
    heading={engage.data.heading}
    background="muted"
  >
    <EngageContent />
    <div class="mt-8">
      <ContactForm
        id="connect"
        form={locale.forms.combined}
        lang={locale.lang ?? 'en'}
        prefill={locale.forms.combined.prefill}
      />
    </div>
    {engage.data.actions && (
      <div class="mt-12">
        <EngageCards actions={engage.data.actions} />
      </div>
    )}
  </Section>
</BaseLayout>
