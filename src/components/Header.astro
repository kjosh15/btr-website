---
import LangToggle from './LangToggle.astro';

const {
  navItems = [],
  locale,
  currentLang = 'en',
  alternate,
} = Astro.props;
---
<header class="sticky top-0 z-50 border-b border-btr-muted bg-white/90 backdrop-blur">
  <div class="mx-auto max-w-6xl px-6 py-4">
    <div class="flex items-center justify-between gap-4">
      <a href="#hero" class="text-lg font-semibold text-btr-text focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent">
        BTR
      </a>
      <nav class="hidden items-center gap-5 text-sm font-medium text-btr-text/75 md:flex">
        {navItems.map((item) => (
          <a
            href={`#${item.id}`}
            class="transition-colors hover:text-btr-text focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent"
          >
            {item.label}
          </a>
        ))}
      </nav>
      <div class="flex items-center gap-3">
        <a
          href="#connect"
          class="hidden rounded-xl border border-btr-accent px-4 py-2 text-sm font-semibold text-btr-accent hover:bg-btr-accent hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent md:inline-flex"
        >
          {locale?.headerCta ?? 'Request Briefing'}
        </a>
        <LangToggle
          currentLang={currentLang}
          alternateLang={alternate.lang}
          alternateHref={alternate.href}
          label={locale.langToggle.label}
          ariaLabel={locale.langToggle.ariaLabel}
        />
        <button
          type="button"
          class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-btr-muted bg-white text-btr-text transition hover:border-btr-accent hover:text-btr-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent md:hidden"
          aria-label="Toggle navigation"
          aria-expanded="false"
          data-nav-toggle
        >
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
            <path d="M4 7h16M4 12h16M4 17h16" />
          </svg>
        </button>
      </div>
    </div>
    <nav
      class="mt-4 hidden flex-col gap-4 text-sm font-medium text-btr-text/80 md:hidden"
      data-nav-panel
    >
      <div class="grid gap-2">
        {navItems.map((item) => (
          <a
            href={`#${item.id}`}
            class="rounded-xl border border-btr-muted px-4 py-2 transition hover:border-btr-accent hover:text-btr-accent focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent"
          >
            {item.label}
          </a>
        ))}
      </div>
      <a
        href="#connect"
        class="inline-flex items-center justify-center rounded-xl border border-btr-accent px-4 py-2 text-sm font-semibold text-btr-accent hover:bg-btr-accent hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-btr-accent"
      >
        {locale?.headerCta ?? 'Request Briefing'}
      </a>
    </nav>
  </div>
</header>
<script client:load>
  const toggle = document.querySelector('[data-nav-toggle]');
  const panel = document.querySelector('[data-nav-panel]');
  if (toggle && panel) {
    const close = () => {
      panel.classList.add('hidden');
      toggle.setAttribute('aria-expanded', 'false');
    };
    toggle.addEventListener('click', () => {
      const isOpen = panel.classList.toggle('hidden');
      toggle.setAttribute('aria-expanded', (!isOpen).toString());
      toggle.classList.toggle('border-btr-accent', !isOpen);
      toggle.classList.toggle('text-btr-accent', !isOpen);
    });
    panel.querySelectorAll('a').forEach((link) =>
      link.addEventListener('click', () => {
        if (window.innerWidth < 768) {
          close();
        }
      }),
    );
  }
</script>
